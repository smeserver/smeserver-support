diff -Nur -x '*.orig' -x '*.rej' smeserver-support-1.4.7/root/sbin/e-smith/console-menu-items/testInternet.pl mezzanine_patched_smeserver-support-1.4.7/root/sbin/e-smith/console-menu-items/testInternet.pl
--- smeserver-support-1.4.7/root/sbin/e-smith/console-menu-items/testInternet.pl	2006-01-05 16:12:02.796360787 +1100
+++ mezzanine_patched_smeserver-support-1.4.7/root/sbin/e-smith/console-menu-items/testInternet.pl	2006-01-05 16:11:45.765323996 +1100
@@ -28,6 +28,10 @@
 {
     use LWP;
     use HTTP::Request::Common;
+    use Digest::SHA1 qw(sha1_hex);
+
+    use esmith::ConfigDB;
+    my $db = esmith::ConfigDB->open_ro or die "Couldn't open ConfigDB\n";
 
     my $console = new esmith::console;
 
@@ -37,43 +41,32 @@
          text  =>
          gettext("After your Internet connection is operational and your server has been connected and configured, this test will verify that your server can communicate with the Internet.") .
          "\n\n" .
-         gettext("As part of this test, a summary of your system configuration will be sent to Mitel Networks. User account names and passwords will not be sent. We appreciate this opportunity to be notified of successful server installations, and will not release this information to anyone outside of Mitel Networks.") .
+         gettext("As part of this test, two pieces of information will be sent to contribs.org - the version installed on your server and a string used to differentiate your server from others using this test. This string is generated by a one-way hash function and access to the string does not provide any information about your server.") . 
+	    "\n\n" .
+	    gettext("We appreciate your assistance in sending this information so we can gain an accurate count of the installed servers.") .
          "\n\n" .
          gettext("Do you wish to run the test?"),
         );
 
     return unless ($rc == 0);
 
-    # get system parameters (filter out accounts and passwords)
+    use constant SERVERTEST => 'http://www.contribs.org/servertest/';
 
-    my @results = ();
-    foreach my $key (keys %conf)
-    {
-        unless (($key =~ /Account$/) || ($key =~ /Password$/))
-        {
-            push @results, $key;
-        }
-    }
+    my $release = esmith::util::determineRelease();
+    my $sysid_hash = sha1_hex($db->get_prop('sysconfig','SystemID'));
 
-    use constant SERVERTEST => 'http://servertest.e-smith.com/report.phtml';
+    my $url = SERVERTEST . "?" . "ReleaseVersion=$release" .
+                                "&SystemIDHash=$sysid_hash";
 
     my $ua = LWP::UserAgent->new;
 
     # add proxy arguments if appropriate
-    if ($conf{'SquidParent'} && ($conf{'SquidParent'} ne ''))
+    if ($db->get_value('SquidParent'))
     {
-        my $parent = $conf{'SquidParent'};
-        my $port = $conf{'SquidParentPort'} || "3128";
+        my $parent = $db->get_value('SquidParent');
+        my $port = $db->get_value('SquidParentPort') || "3128";
         $ua->proxy(['http', 'ftp'], "http://$parent:$port/");
     }
-    my $release = esmith::util::determineRelease();
-    my $request = POST(SERVERTEST,
-                       Content => [
-                                   state => 'serverTestAddCommitVersion41',
-                                   esmithVersion => $release,
-                                   map { $_ => $conf{$_} } @results,
-                                  ],
-                      );
 
     print '-' x 75 . "\n";
     print gettext("Attempting to test Internet connection.") . "\n";
@@ -84,7 +77,8 @@
 
     eval {
         local $SIG{INT} = sub {die 1};
-        $response = $ua->request($request);
+
+        $response = $ua->get($url);
     };	
 
     if ($response->is_success)
@@ -93,7 +87,7 @@
             (
              title => gettext("Internet connection successful"),
              text  =>
-             gettext("The test was successful! Your server was able to communicate with Mitel Networks."),
+             gettext("The test was successful! Your server was able to communicate with contribs.org."),
             );
     }
     else
@@ -106,15 +100,15 @@
             (
              title => "Internet connection failed",
              text  =>
-             gettext("The test failed. Your server was unable to establish contact with Mitel Networks via the Internet.") .
+             gettext("The test failed. Your server was unable to establish contact with contribs.org via the Internet.") .
              "\n\n" .
              gettext("Please check that your server is correctly configured. A reboot may be required if certain settings are modified and the configuration process will advise you if this is required.") .
              "\n\n" .
              gettext("You might also want to check with your Internet provider to make sure that your Internet connection is working properly.") .
              "\n\n" .
-             gettext("It is also possible (although unlikely) that there is a technical problem at the Mitel Networks site. In this case, you should proceed with your installation and run this test again later."),
+             gettext("It is also possible (although unlikely) that there is a technical problem at the contribs.org site. In this case, you should proceed with your installation and run this test again later."),
             );
     }
 }
 
-return new esmith::console::testInternetAccess;
+new esmith::console::testInternetAccess;
